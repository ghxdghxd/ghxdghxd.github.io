<div class="header">
  <h1 class="page-title">
    <a class="icon circle-icon glyphicon glyphicon-chevron-left trigger-message-close"></a>
    pandas
  </h1>
  <div class="details">
    <div class="left">
      10月 12, 2016
      <span> | </span> <a href="/category/xiao-chao-su-cha.html">小抄速查</a>
    </div>
    <div class="right">
      <a class="fa fa-tag" href="/tag/python.html">python</a>
      <a class="fa fa-tag" href="/tag/pandas.html">pandas</a>
    </div>
  </div>
</div>
<div id="message-nano-wrapper" class="nano">
  <div class="nano-content">
    <ul class="message-container">
        <div class="message">
          <h1>常用</h1>
<h2>read_csv</h2>
<div class="highlight"><pre><span class="code-line"><span></span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="nb">file</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span> <span class="c1"># 第一行不设为列名</span></span>
<span class="code-line"><span class="n">bed_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="nb">file</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;object&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;chr&#39;</span><span class="p">,</span> <span class="s1">&#39;start&#39;</span><span class="p">,</span> <span class="s1">&#39;pos&#39;</span><span class="p">,</span> <span class="s1">&#39;ref&#39;</span><span class="p">,</span> <span class="s1">&#39;alt&#39;</span><span class="p">])</span></span>
</pre></div>


<h2>cat 合并</h2>
<div class="highlight"><pre><span class="code-line"><span></span><span class="n">Series</span><span class="p">([</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39;c&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="s1">&#39;C&#39;</span><span class="p">],</span><span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span></span>
</pre></div>


<h2>filter</h2>
<div class="highlight"><pre><span class="code-line"><span></span><span class="n">mat</span><span class="p">[</span><span class="n">mat</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">)]</span></span>
</pre></div>


<h2>dataframe to list</h2>
<div class="highlight"><pre><span class="code-line"><span></span><span class="n">mat</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span></span>
</pre></div>


<h2>merge dataframe</h2>
<div class="highlight"><pre><span class="code-line"><span></span><span class="n">pd</span><span class="o">.</span><span class="n">connect</span><span class="p">([</span><span class="n">mat1</span><span class="p">,</span> <span class="n">mat2</span><span class="p">,</span> <span class="n">mat3</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1">#axis=1 cbind, asis=0 rbind</span></span>
</pre></div>


<h2>insert</h2>
<div class="highlight"><pre><span class="code-line"><span></span><span class="n">mat</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="n">date</span><span class="p">)</span> <span class="c1"># insert in 0 col</span></span>
</pre></div>


<h1>pandas错误</h1>
<blockquote>
<p>read_csv: C-engine CParserError: Error tokenizing data</p>
</blockquote>
<p>When using read_csv like this:</p>
<div class="highlight"><pre><span class="code-line"><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="s1">&#39;faulty_row.pkl&#39;</span><span class="p">)</span></span>
<span class="code-line"><span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;faulty_row.csv&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span></span>
<span class="code-line"><span class="n">df</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;faulty_row.csv&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span></span>
</pre></div>


<p>You get the following exception:</p>
<div class="highlight"><pre><span class="code-line"><span></span>CParserError: Error tokenizing data. C error: Buffer overflow caught - possible malformed input file.</span>
</pre></div>


<ul>
<li>Solution 1</li>
</ul>
<p>You can read the CSV using the python engine then no exception is thrown:</p>
<div class="highlight"><pre><span class="code-line"><span></span><span class="n">df</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;faulty_row.csv&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;python&#39;</span><span class="p">)</span></span>
</pre></div>


<ul>
<li>Solution 2</li>
</ul>
<p>If your second-to-last line includes an '\r' break.
You can open in universal-new-line mode to solve the error.</p>
<div class="highlight"><pre><span class="code-line"><span></span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s1">&#39;test.csv&#39;</span><span class="p">,</span><span class="s1">&#39;rU&#39;</span><span class="p">),</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;c&#39;</span><span class="p">)</span></span>
</pre></div>
        </div>
        <!-- <div class="tool-box">
          <a href="#" class="circle-icon small glyphicon glyphicon-share-alt"></a>
          <a href="#" class="circle-icon small red-hover glyphicon glyphicon-remove"></a>
          <a href="#" class="circle-icon small red-hover glyphicon glyphicon-flag"></a>
        </div> -->
    </ul>
  </div>
</div>

<script>
  $('.nano').overlayScrollbars({
    scrollbars: {
      autoHide: "leave",
    }
  });
  $('.trigger-message-close').on('click', function () {
    $('body').removeClass('show-message');
    $('#main .message-list li').removeClass('active');
    messageIsOpen = false;
    $('body').removeClass('show-main-overlay');
  });
  $('#message .header .left a').on('click', function (e) {
    e.preventDefault();
    helper.setQuery().clearRefinements().addDisjunctiveFacetRefinement("category", e.target.text).search();
    
  });
  $('#message .header .right a').on('click', function (e) {
    e.preventDefault();
    helper.setQuery().clearRefinements().addFacetRefinement("tags", e.target.text).search();
  });
</script>