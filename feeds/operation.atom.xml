<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>iKnowledgeBase - operation</title><link href="https://ghxdghxd.github.io/" rel="alternate"></link><link href="https://ghxdghxd.github.io/feeds/operation.atom.xml" rel="self"></link><id>https://ghxdghxd.github.io/</id><updated>2017-11-05T19:30:00+08:00</updated><entry><title>docker安装与配置</title><link href="https://ghxdghxd.github.io/docker.html" rel="alternate"></link><published>2017-11-03T10:20:00+08:00</published><updated>2017-11-05T19:30:00+08:00</updated><author><name>JT Guo</name></author><id>tag:ghxdghxd.github.io,2017-11-03:/docker.html</id><summary type="html">&lt;p&gt;docker的简单安装与配置&lt;/p&gt;</summary><content type="html">&lt;h1&gt;docker&lt;/h1&gt;
&lt;h2&gt;centos yum install docker&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;tee /etc/yum.repos.d/docker.repo &lt;span class="s"&gt;&amp;lt;&amp;lt;-&amp;#39;EOF&amp;#39;&lt;/span&gt;
&lt;span class="s"&gt;[dockerrepo]&lt;/span&gt;
&lt;span class="s"&gt;name=Docker Repository&lt;/span&gt;
&lt;span class="s"&gt;baseurl=https://yum.dockerproject.org/repo/main/centos/$releasever/&lt;/span&gt;
&lt;span class="s"&gt;enabled=1&lt;/span&gt;
&lt;span class="s"&gt;gpgcheck=1&lt;/span&gt;
&lt;span class="s"&gt;gpgkey=https://yum.dockerproject.org/gpg&lt;/span&gt;
&lt;span class="s"&gt;EOF&lt;/span&gt;

sed -i &lt;span class="s1"&gt;&amp;#39;s/other_args=\&amp;quot;\&amp;quot;/other_args=\&amp;quot;--graph=\/share\/apps\/docker\&amp;quot;/g&amp;#39;&lt;/span&gt; /etc/sysconfig/docker

&lt;span class="k"&gt;for&lt;/span&gt; i in &lt;span class="sb"&gt;`&lt;/span&gt;seq &lt;span class="m"&gt;1&lt;/span&gt; &lt;span class="m"&gt;8&lt;/span&gt;&lt;span class="sb"&gt;`&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="k"&gt;do&lt;/span&gt;
    sudo scp /etc/yum.repos.d/docker.repo compute-0-&lt;span class="nv"&gt;$i&lt;/span&gt;:/etc/yum.repos.d/docker.repo
&lt;span class="k"&gt;done&lt;/span&gt;

rocks run host &lt;span class="s2"&gt;&amp;quot;yum install docker-engine&amp;quot;&lt;/span&gt;
rocks run host &lt;span class="s2"&gt;&amp;quot;sed -i &amp;#39;s/other_args=\&amp;quot;\&amp;quot;/other_args=\&amp;quot;--graph=\/share\/apps\/docker\&amp;quot;/g&amp;#39; /etc/sysconfig/docker&amp;quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;!--more--&gt;

&lt;h2&gt;手动安装&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# 手动安装centos6.5 一些需要安装&lt;/span&gt;
yum remove docker-engine
&lt;span class="nb"&gt;cd&lt;/span&gt; /share/apps/until/docker/
yum install ./lua-filesystem-1.4.2-1.el6.x86_64.rpm
yum install ./lxc-libs-1.0.11-1.el6.x86_64.rpm
yum install ./lua-lxc-1.0.11-1.el6.x86_64.rpm
yum install ./lua-alt-getopt-0.7.0-1.el6.noarch.rpm
yum install ./lxc-1.0.11-1.el6.x86_64.rpm
yum install ./docker-io-1.7.1-2.el6.x86_64.rpm
wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-6.repo
yum install device-mapper-event-libs
service docker restart
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;安装错误&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# 下面错误：&lt;/span&gt;
/usr/bin/docker: relocation error: /usr/bin/docker: symbol dm_task_get_info_with_deferred_remove, version Base not defined in file libdevmapper.so.1.02 with link &lt;span class="nb"&gt;time&lt;/span&gt; reference
fix: $ sudo yum install device-mapper-event-libs
&lt;span class="c1"&gt;# 如果无法安装，重新更新&lt;/span&gt;
wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-6.repo
&lt;span class="c1"&gt;# 然后再安装&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;docker应用&lt;/h2&gt;
&lt;h3&gt;启动docker&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;service docker start
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;添加用户&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# 添加docker group：&lt;/span&gt;
sudo groupadd docker

&lt;span class="c1"&gt;# 将当前用户添加到docker组：&lt;/span&gt;
sudo gpasswd -a &lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;USER&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt; docker

&lt;span class="c1"&gt;# 重启docker服务：&lt;/span&gt;
sudo service docker restart
&lt;span class="c1"&gt;# 开机启动&lt;/span&gt;
chkconfig docker on
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;修改镜像和容器的存放路径&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# /etc/sysconfig/docker加入：&lt;/span&gt;
&lt;span class="nv"&gt;other_args&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;--graph=/data/docker&amp;quot;&lt;/span&gt;

&lt;span class="c1"&gt;# 停止Docker服务&lt;/span&gt;
service docker stop
&lt;span class="c1"&gt;# 备份数据到新的存放路径&lt;/span&gt;
cp -rf /var/lib/docker /data/
&lt;span class="c1"&gt;# 修改备份/var/lib/docker路径&lt;/span&gt;
mv /var/lib/docker&lt;span class="o"&gt;{&lt;/span&gt;,.bak&lt;span class="o"&gt;}&lt;/span&gt;
&lt;span class="c1"&gt;# 启动Docker服务&lt;/span&gt;
service docker start
&lt;span class="c1"&gt;# 测试Docker服务&lt;/span&gt;
docker info
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;用法&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;查看镜像 docker images&lt;/li&gt;
&lt;li&gt;查找镜像 docker search&lt;/li&gt;
&lt;li&gt;查看容器 docker ps -a&lt;/li&gt;
&lt;li&gt;运行容器 docker run&lt;/li&gt;
&lt;li&gt;将宿主机的/var/data挂载到容器中的/data: docker run -tdi -v /var/data:/data centos&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;如果ls: cannot open directory '.': Permission denied
修改/etc/sysconfig/docker，OPTIONS去掉--selinux-enabled&lt;/p&gt;</content><category term="awesome"></category><category term="interest"></category></entry></feed>